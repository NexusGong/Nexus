# 文档变更日志（Documentation Changelog）

所有重要的文档变更都将记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
并且此项目遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [未发布]

## 2025-11-21

### 更新
- 新增 `DAILY_SUMMARY_2025_11_21.md`，记录AI角色系统全面升级和优化
- 更新 `IMPLEMENTATION_STATUS.md`，添加角色管理功能和新增角色信息

### 新增
- 角色管理功能：用户角色拥有状态管理
- 16个AI角色（聚焦沟通问题解决）
- 游戏化稀有度系统（SSR/SR/R/N）
- 角色管理页面和API
- 空对话过滤机制

### 重要变更
- 修复空对话问题：延迟对话创建，避免无效数据
- 重新设计AI角色系统：所有角色聚焦沟通问题解决
- 角色稀有度调整：经典IP为SR，动漫和影视剧为SSR，原创为R
- 角色选择页面优化：紧凑布局，按稀有度排序
- 角色切换改为对话框形式
- 添加返回按钮和角色管理入口

### 技术改进
- 延迟对话创建逻辑，提升用户体验
- 使用 `sqlalchemy.exists` 过滤空对话
- 创建 `UserCharacter` 模型记录用户角色拥有状态
- 创建角色更新脚本支持角色管理

## 2025-11-07

### 更新
- 新增 `DAILY_SUMMARY_2025_11_07.md`，记录用户认证系统、使用限制系统、用户资料管理等功能的实现。
- 更新根 README：添加用户认证、使用限制、数据隔离等相关功能说明。

### 新增
- 用户注册和登录功能（邮箱/手机验证码）
- 使用次数限制系统（登录用户vs非登录用户）
- 用户资料管理（包括头像上传）
- 登录状态持久化
- 数据隔离（session_token机制）

### 重要变更
- 非登录用户和登录用户的使用次数限制不同
- 登录时自动关联未登录时创建的对话和卡片
- 用户只能看到自己创建的对话和卡片

## 2025-11-06

### 更新
- 新增 `DAILY_SUMMARY_2025_11_06.md`，记录预览页“添加图片”入口统一与交互修复。
- 文档同步前端 UI 变更：移除旧按钮、统一触发同一隐藏文件输入、保留顶部“上传图片”按钮。
 - 根 README/文档索引移除百度OCR相关描述，统一为豆包OCR / 火山引擎OCR；批量OCR参数从 `mode` 调整为 `provider` 示例。

### 重要变更
- 预览网格末尾“添加图片”卡片成为唯一追加入口（与顶部按钮并存）。
- 规避重复 `ref` 的隐藏输入导致的潜在冲突。

## 2025-11-05

### 更新
- 新增 `DAILY_SUMMARY_2025_11_05.md`，记录今日可取消OCR、UI优化与后端修复。
- 更新产品变更日志：加入可取消能力、UI 改进与 bug 修复条目。

### 重要变更
- 识别中仅保留卡片内进度与操作，移除顶部全局进度条文档描述。
- 失败态展示规范调整为小徽标，不再使用整图遮罩。

## 2025-10-31

### 更新
- 同步文档至最新代码改动：
  - 主题切换统一（HTML `dark` + `theme-changing` 瞬时禁用过渡）。
  - Toast 视口调整到正中央并 0.5s 自动消失。
  - 前端样式改为主题令牌；聊天与卡片的暗色可读性更新。
  - 后端导出服务改为 Playwright 渲染 PNG 长图，修复 header 编码（latin-1）问题。
  - 空对话避免策略说明（仅在首条消息时创建）。
- 新增 `DAILY_SUMMARY_2025_10_31.md` 开发记录。

### 新增
- 导出文件名优化（主题+时间格式，ASCII + UTF-8 filename* 兼容）
- 时区支持完善（用户本地时间）
- 文件名安全性过滤
- 智能文件名生成逻辑

### 重要变更
- PDF 导出已下线，统一为图片导出。
- 部署与本地运行新增 Playwright 浏览器安装步骤：`python -m playwright install chromium`。

### 2025-10-29

#### 新增
- 批量OCR接口与结构化输出文档（己方/对方、气泡级分块）。
- 多图上传与段落筛选的交互规范（镜像排布、角色着色、勾选位置）。
- 后端阶段计时日志说明（编码/构包/发送/解析/总计）。

#### 改进
- 识别等待文案精简；成功不再弹toast。
- 批量识别默认限制4张以优化端到端时延。

#### 修复
- 兼容 `.env` OCR扩展字段，避免Pydantic校验错误。





